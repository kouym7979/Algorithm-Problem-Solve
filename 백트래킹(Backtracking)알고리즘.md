## 백트래킹(Backtracking)알고리즘

**백트래킹**



기본적으로 백트래킹은 '가능한 모든 방법을 탐색한다' 는데 기본 아이디어가 있다. 대표적인 완전 탐색 방법으로는 DFS (Depth First Search, 깊이 우선 탐색) 이 있다. DFS 는 현재 지점에서 방문할 곳이 있으면 재귀 호출을 이용해서 계속 이동한다. DFS 의 장점은 무한히 깊은곳을 찾아야할때 효과적이다. 하지만 DFS 는 모든곳을 방문하기 때문에 굳이 목표지점이 있지 않는 경로로 빠져서 비효율적인 결과를 초래할수도 있다.



그래서 이와 같은 비효율적인 경로를 차단하고 목표지점에 갈수있는 가능성이 있는 루트를 검사하는 방법이 백트래킹 알고리즘이다. 백트래킹은 DFS에 가지치기 (Pruning) 를 통해 가도되지 않는 루트는 고려하지 않고 탐색하는 완전탐색 기법이다. 가지치기를 얼마나 잘하느냐에 따라서 효율이 극대화 될수 있는 방법이다.



뭔말이지 하는 사람도 있을껀데 어쨋든 우리가 알아야할것은 "배제", "풀이 시간 단축" 이다. 이론보다는 예시로 설명하는 것이 더 이해가 잘될것 같다. 구글 검색창에 백트래킹이라고 검색하면 항상 딸려오는 대표 예제인 n-queen 으로 백트래킹을 설명하겠다.

**N-Queen**

백트래킹 하면 바로 이문제라고 알려져 있을 정도로 유명하다고 한다. 문제는 아래와 같다.



크기가 N * N 인 체스판 위에 퀸 N 개를 서로 공격할 수 없게 놓는 문제이다. N이 주어졌을 때, 퀸을 놓는 방법의 수를 구하는 프로그램을 작성하시오.



4 * 4 를 기준으로 문제를 풀어보자. 체스를 모르는 사람도 풀수 있는 문제다. 퀸은 배치된 칸을 기준으로 오와 열, 대각선 이동이 가능한 말이다. 아래의 사진을 보면 이해가 될것이다.



![img](https://t1.daumcdn.net/cfile/tistory/99B8D13F5A927B1132)



빨간색 선이 퀸이 이동할수 있는 경로이고, 첫번째 퀸과 공격할수 없게 배치할려면 2번째 줄은 2, 3 번째 위치에 퀸을 놓아야 된다. 첫번째 퀸의 위치를 (1, 1) 로 하면 트리구조는 다음과 같다.





![img](https://t1.daumcdn.net/cfile/tistory/99B834345A927C0818)



만약 이문제를 가지치기 하지않는 DFS 로 풀이했다면 유망하지 않는 (2, 1), (2, 2) 지점도 검사를 했을것이다. 그렇게되면 더큰 체스판에서 퀸을 놓는 경우의 수를 찾을때 수많은 연산이 일어나게된다.



그래서 우리는 가지치기를 잘해야한다! 백트래킹은 크게 4가지 절차로 구성되어 있다.

**DFS 수행 - 유망한 노드 검토 - 서브 트리 이동 - 백트래킹 수행**

1. DFS 수행 - 먼저 평소와 같이 깊이우선탐색인 DFS 를 수행하여 노드를 찾는다.
2. 유망한 노드 검토 - 방문한 노드를 포함해서 유망한 노드이면 서브트리로 이동하고 그렇지 않으면 백트래킹을 수행한다.
3. 방문한 노드의 하위 노드로 이동하여 다시 재귀를 통해 DFS 를 수행한다.
4. 백트래킹 수행 - 방문한 노드를 가지치기를 하고 상위 노드로 백트래킹 한 후 DFS 를 다시 수행한다.

이절차를 통해서 2번째 위치에 퀸을 놓는 방법을 생각해보자.

1. (1, 1) 에서 시작하여 DFS 수행을 통해 가장 첫번째 노드인 (2, 1) 지점으로 간다.
2. (2, 1) 노드를 검사해보니 첫번째 퀸의 이동반경에 포함되기 때문에 유망한 노드가 아니어서 백트래킹을 수행하여 상위 노드인 (1, 1) 지점으로 이동한다.
3. 다시 DFS 를 수행하여 다음 노드인 (2, 2) 로 이동한다.
4. (2, 2) 노드를 검사해보니 첫번째 퀸의 이동반경에 포함되기 때문에 유망한 노드가 아니어서 백트래킹을 수행하여 상위 노드인 (1, 1) 지점으로 이동한다.
5. 다시 DFS 를 수행하여 다음 노드인 (2, 3) 로 이동한다.
6. (2, 3) 노드를 검사해보니 첫번째 퀸의 이동반경에 포함되지 않아서 유망한 노드가 되었다. 이제 (2, 3) 을 기준으로 DFS 를 수행하여 3번째 퀸의 위치를 찾는다.

이렇듯 가지치기를 통해서 해당 노드가 유망하지 않으면 가차없이 짤라버려서 탐색하는 경로를 최소한으로 줄일수 있게 된다.